(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{206:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return a(5066)}])},5066:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var l=a(4848),n=a(6540),r=a(3013);function s(){return(0,l.jsxs)("nav",{className:"navbar",children:[(0,l.jsx)("h1",{className:"navbar-title",children:"CodeEcho"}),(0,l.jsx)("button",{onClick:()=>(0,r.signOut)({callbackUrl:"/"}),className:"nav-signout",children:"Sign Out"})]})}function c(e){let{node:t,exclusions:a,togglePaths:r}=e,[s,o]=(0,n.useState)(!1),i=e=>{let t=[e.path];return e.children&&e.children.length>0&&e.children.forEach(e=>{t=t.concat(i(e))}),t},d=!a.includes(t.path);return(0,l.jsxs)("li",{className:"folder-tree-item",children:[(0,l.jsxs)("div",{className:"folder-tree-container",children:[t.children&&t.children.length>0&&(0,l.jsx)("span",{className:"folder-tree-toggle",onClick:()=>o(!s),children:s?"▼":"►"}),""!==t.path&&(0,l.jsxs)("label",{className:"folder-tree-label",children:[(0,l.jsx)("input",{type:"checkbox",checked:d,onChange:()=>{r(i(t),d)},className:"folder-tree-checkbox"}),(0,l.jsxs)("span",{className:"folder-tree-name",children:[t.name," ","directory"===t.type?"(Folder)":"(File)"]}),(0,l.jsx)("span",{className:"folder-tree-size",children:function(e){if(e<1024)return e+" B";let t=e/1024;return t<1024?t.toFixed(2)+" KB":(t/1024).toFixed(2)+" MB"}(t.size)})]})]}),t.children&&t.children.length>0&&s&&(0,l.jsx)("ul",{className:"folder-tree-list",children:t.children.map(e=>(0,l.jsx)(c,{node:e,exclusions:a,togglePaths:r},e.path))})]})}function o(){let{data:e}=(0,r.useSession)(),[t,a]=(0,n.useState)([]),[o,i]=(0,n.useState)(null),[d,h]=(0,n.useState)([]),[u,p]=(0,n.useState)(""),[x,m]=(0,n.useState)(null),[f,j]=(0,n.useState)(!1),[N,g]=(0,n.useState)(null),[v,b]=(0,n.useState)(!1),[y,w]=(0,n.useState)([]),S=(0,n.useRef)(null);(0,n.useEffect)(()=>{e&&fetch("/api/repos").then(e=>e.json()).then(e=>{Array.isArray(e)?a(e):a([])}).catch(e=>console.error("Error fetching repos:",e))},[e]);let k=async()=>{if(!o||!u)return;j(!0);let{owner:e,repo:t}=o;try{let a=JSON.stringify(y),l=await fetch("/api/fetchRepo?owner=".concat(e,"&repo=").concat(t,"&branch=").concat(u,"&exclusions=").concat(encodeURIComponent(a))),n=await l.json();m(n)}catch(e){console.error("Error fetching repository data:",e)}finally{j(!1)}};return((0,n.useEffect)(()=>{x&&S.current&&S.current.scrollIntoView({behavior:"smooth"})},[x]),e)?(0,l.jsxs)("div",{className:"container",children:[(0,l.jsx)(s,{}),(0,l.jsx)("h2",{className:"page-title",children:"Repository Explorer"}),(0,l.jsxs)("div",{className:"panel",children:[(0,l.jsx)("h3",{children:"Select Repository"}),(0,l.jsxs)("select",{onChange:e=>{let t=e.target.value;if(!t)return;let[a,l]=t.split("/");i({owner:a,repo:l}),h([]),g(null),w([]),fetch("/api/branches?owner=".concat(a,"&repo=").concat(l)).then(e=>e.json()).then(e=>h(e)).catch(e=>console.error("Error fetching branches:",e))},defaultValue:"",children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"Select a repository"}),Array.isArray(t)&&t.map(e=>(0,l.jsx)("option",{value:"".concat(e.owner.login,"/").concat(e.name),children:e.full_name},e.id))]})]}),d.length>0&&(0,l.jsxs)("div",{className:"panel",children:[(0,l.jsx)("h3",{children:"Select Branch"}),(0,l.jsxs)("select",{onChange:e=>{if(p(e.target.value),o){let{owner:t,repo:a}=o;b(!0),fetch("/api/folderStructure?owner=".concat(t,"&repo=").concat(a,"&branch=").concat(e.target.value)).then(e=>e.json()).then(e=>{g(e),b(!1)}).catch(e=>{console.error("Error fetching folder structure:",e),b(!1)})}},defaultValue:"",children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"Select a branch"}),d.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.name))]})]}),u&&(0,l.jsxs)("div",{className:"panel",children:[(0,l.jsx)("h3",{children:"Include / Exclude Files & Folders"}),v?(0,l.jsx)("div",{className:"spinner"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{children:"All items are included by default. Uncheck an item to exclude it (this will also unselect all its sub-items)."}),N&&(0,l.jsx)("ul",{className:"folder-tree-list",children:(0,l.jsx)(c,{node:N,exclusions:y,togglePaths:(e,t)=>{t?w(t=>{let a=new Set(t);return e.forEach(e=>a.add(e)),Array.from(a)}):w(t=>t.filter(t=>!e.includes(t)))}})})]})]}),o&&u&&(0,l.jsx)("div",{className:"panel",children:(0,l.jsx)("button",{onClick:k,children:"Fetch Repository Data"})}),f&&(0,l.jsx)("div",{className:"panel",children:(0,l.jsx)("div",{className:"spinner"})}),x&&(0,l.jsxs)("div",{className:"panel panel-relative",ref:S,children:[(0,l.jsx)("button",{onClick:()=>{x&&x.text&&navigator.clipboard.writeText(x.text).then(()=>alert("Output copied to clipboard!")).catch(()=>alert("Failed to copy output."))},className:"copy-button",children:"Copy"}),(0,l.jsx)("h3",{children:"Repository Data"}),(0,l.jsx)("textarea",{readOnly:!0,value:x.text,className:"repo-textarea"}),(0,l.jsxs)("p",{children:["Total Estimated Tokens: ",x.totalTokens]}),(0,l.jsx)("p",{className:"small-note",children:"(For optimal performance, we recommend a maximum of 150k tokens for use with o1 and o3-mini models.)"})]})]}):(0,l.jsx)("div",{className:"container",children:(0,l.jsx)("p",{children:"Please sign in to view your repository explorer."})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(206)),_N_E=e.O()}]);